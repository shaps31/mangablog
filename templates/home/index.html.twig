{# templates/home/index.html.twig #}
{% extends 'base.html.twig' %}
{% block title %}Accueil â€” MangaBlog{% endblock %}

{% block body %}
    {# HERO #}
    <section class="hero p-4 p-lg-5 mb-4 reveal" data-animate="fade">
        <div class="row align-items-center">
            <div class="col-lg-7">
                <h1 class="fw-bold mb-2">Bienvenue sur MangaBlog</h1>
                <p class="text-muted mb-3">
                    Actus, critiques et classements autour du manga. DÃ©couvre les sÃ©ries qui font vibrer 2025 âœ¨
                </p>
                <a class="btn btn-primary btn-lg" href="{{ path('blog_index') }}">Voir les derniers articles</a>
            </div>
            <div class="col-lg-5 text-center d-none d-lg-block">
                <img src="{{ asset('img/cover-placeholder.png') }}" alt="" style="max-height:220px" class="img-fluid">
            </div>
        </div>
    </section>

    {# CATEGORIES POPULAIRES #}
    <section class="mb-4 reveal" data-animate="left">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h2 class="h4 fw-bold m-0">CatÃ©gories populaires</h2>
            <a class="small text-decoration-none" href="{{ path('blog_index') }}">Tout le blog â†’</a>
        </div>

        <div class="d-flex flex-wrap gap-2">
            {% for row in popularCategories %}
                {# row attendu sous forme scalaire : { id, name, total } #}
                <a class="badge badge-tag"
                   href="{{ path('blog_index', {'category': row.id, 'page': 1}) }}">
                    {{ row.name }} <span class="text-muted">({{ row.total }})</span>
                </a>
            {% else %}
                <span class="text-muted">Aucune catÃ©gorie pour lâ€™instant.</span>
            {% endfor %}
        </div>
    </section>

    {# EN TENDANCE #}
    {% if trending|length %}
        <section class="mb-4 reveal" data-animate="right">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h2 class="h4 fw-bold m-0">En tendance ðŸ”¥</h2>
                <a class="small text-decoration-none" href="{{ path('blog_index') }}">Voir plus â†’</a>
            </div>

            <div class="row row-cols-1 row-cols-md-3 g-3">
                {% for row in trending %}
                    {# CompatibilitÃ© :
             - format A: row = { post: Post, comments: int }
             - format B: row = Post directement (sans .post)
                    #}
                    {% set post = row.post is defined ? row.post : row %}
                    {% set commentsCount = row.comments is defined
                        ? row.comments
                        : (post.comments|filter(c => c.status == 'approved')|length) %}

                    <div class="col">
                        <div class="card h-100">
                            {% set coverUrl = post.cover ?: asset('img/cover-placeholder.png') %}
                            <img src="{{ coverUrl }}" class="img-cover" alt="Cover : {{ post.title }}" loading="lazy">
                            <div class="card-body">
                                <div class="small text-muted mb-1">
                                    {{ post.publishedAt ? post.publishedAt|date('d/m/Y') : 'â€”' }} â€¢ {{ post.category ? post.category.name : 'â€”' }}
                                </div>
                                <h3 class="h5 card-title">
                                    <a class="text-decoration-none" href="{{ path('blog_show', {slug: post.slug}) }}">{{ post.title }}</a>
                                </h3>
                                <p class="text-muted small mb-3">{{ post.content|striptags|u.truncate(140, 'â€¦') }}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <a class="btn btn-sm btn-read" href="{{ path('blog_show', {slug: post.slug}) }}">Lire</a>
                                    <small class="text-muted">{{ commentsCount }} com.</small>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </section>
    {% endif %}

    {# 3 DERNIERS EN GRAND #}
    {% if latest|length %}
        <section class="mb-4 reveal" data-animate="fade">
            <h2 class="h4 fw-bold mb-2">Derniers articles</h2>
            <div class="row row-cols-1 row-cols-md-3 g-3">
                {% for post in latest %}
                    <div class="col">
                        <div class="card h-100">
                            {% set coverUrl = post.cover ?: asset('img/cover-placeholder.png') %}
                            <img src="{{ coverUrl }}" class="img-cover" alt="Cover : {{ post.title }}" loading="lazy">
                            <div class="card-body">
                                <div class="small text-muted mb-1">
                                    {{ post.publishedAt ? post.publishedAt|date('d/m/Y') : 'â€”' }} â€¢ {{ post.category ? post.category.name : 'â€”' }}
                                </div>
                                <h3 class="h5 card-title">
                                    <a class="text-decoration-none" href="{{ path('blog_show', {slug: post.slug}) }}">{{ post.title }}</a>
                                </h3>
                                <p class="text-muted small mb-3">{{ post.content|striptags|u.truncate(160, 'â€¦') }}</p>
                                <a class="btn btn-sm btn-read" href="{{ path('blog_show', {slug: post.slug}) }}">Lire</a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </section>
    {% endif %}

    {# CITATION / SLOGAN #}
    <section class="mb-4 reveal" data-animate="left">
        <div class="p-4 p-lg-5 text-center border bg-white rounded-4">
            <blockquote class="mb-0 fw-bold" style="font-size:1.2rem">
                Â« Le manga est un art de vivre. Ici, on le partage. Â»
            </blockquote>
        </div>
    </section>

    {# TAGS POPULAIRES #}
    {% if topTags|length %}
        <section class="mb-4 reveal" data-animate="right">
            <h2 class="h4 fw-bold mb-2">DÃ©couvrir par tags</h2>
            <div class="tag-cloud">
                {% for row in topTags %}
                    {# Compatible deux formats :
             - A: { name, c }
             - B: { tag: { id, name }, c }
                    #}
                    {% set tagName = row.name is defined ? row.name : (row.tag is defined ? row.tag.name : '') %}
                    {% set tagId   = row.id   is defined ? row.id   : (row.tag is defined ? row.tag.id   : null) %}
                    {% if tagId %}
                        <a href="{{ path('blog_index', {'tag': tagId, 'page': 1}) }}"># {{ tagName }}</a>
                    {% else %}
                        <span class="text-muted"># {{ tagName }}</span>
                    {% endif %}
                {% endfor %}
            </div>
        </section>
    {% endif %}

    {# CTA final #}
    <div class="text-center">
        <a class="btn btn-lg btn-primary" href="{{ path('blog_index') }}">Voir tout le blog</a>
    </div>
{% endblock %}
