{# templates/blog/show.html.twig #}
{% extends 'base.html.twig' %}
{% block title %}{{ post.title }} ‚Äî MangaBlog{% endblock %}

{% block body %}
    <article class="bg-white p-4 border rounded mb-4">
        <h1 class="h3 mb-2">{{ post.title }}</h1>

        {# ‚úÖ Cover avec fallback local si post.cover est vide #}
        {% set coverUrl = post.cover ?: asset('img/cover-placeholder.png') %}
        <img src="{{ coverUrl }}" class="img-fluid rounded mb-3" alt="Couverture">

        {# üîó Badges de tags cliquables (renvoient vers la liste filtr√©e par ce tag) #}
        {% if post.tags|length %}
            <div class="mb-3">
                {% for t in post.tags %}
                    <a
                        class="badge bg-secondary text-decoration-none me-1"
                        href="{{ path('blog_index', {'tag': t.id, 'page': 1}) }}"
                    >
                        {{ t.name }}
                    </a>
                {% endfor %}
            </div>
        {% endif %}

        <div class="text-muted small mb-3">
            Publi√© {{ post.publishedAt ? post.publishedAt|date('Y-m-d H:i') : 'brouillon' }}
            ‚Ä¢ Cat√©gorie : {{ post.category.name }}
        </div>

        {# Affichage du contenu avec respect des retours √† la ligne #}
        <div style="white-space: pre-line;">
            {{ post.content }}
        </div>

        <div class="mt-3">
            <a href="{{ path('blog_index') }}" class="btn btn-outline-secondary btn-sm">‚Üê Retour au blog</a>
        </div>
    </article>

    <h2 class="h5 mb-3">Commentaires</h2>

    {% if comments is empty %}
        <p class="text-muted">Aucun commentaire approuv√© pour le moment.</p>
    {% else %}
        <div class="vstack gap-3 mb-4">
            {% for c in comments %}
                <div class="p-3 border rounded bg-white">
                    <div class="small text-muted mb-2">
                        {{ c.createdAt|date('Y-m-d H:i') }} ‚Äî {{ c.author.userIdentifier }}
                    </div>
                    <div style="white-space: pre-line;">{{ c.content }}</div>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    {# Formulaire de commentaire si connect√© #}
    {% if app.user %}
        <div class="bg-white p-3 border rounded">
            <h3 class="h6">Laisser un commentaire</h3>
            {{ form_start(form) }}
            {{ form_row(form.content) }}
            <button class="btn btn-primary btn-sm">Envoyer</button>
            {{ form_end(form) }}
        </div>
    {% else %}
        <div class="alert alert-info">
            Connecte-toi pour commenter :
            <a class="btn btn-sm btn-outline-primary" href="{{ path('app_login') }}">Se connecter</a>
            ou <a class="btn btn-sm btn-outline-secondary" href="{{ path('app_register') }}">Cr√©er un compte</a>
        </div>
    {% endif %}
{% endblock %}
