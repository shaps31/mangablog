{# templates/blog/show.html.twig #}
{% extends 'base.html.twig' %}
{% block title %}{{ post.title }} · MangaBlog{% endblock %}

{% block body %}
    <article class="bg-white p-4 border rounded mb-4">
        <h1 class="h3 mb-2">{{ post.title }}</h1>
        <div class="text-muted small mb-3">
            Publié {{ post.publishedAt ? post.publishedAt|date('Y-m-d H:i') : 'brouillon' }}
            • Catégorie : {{ post.category.name }}
        </div>

        <div style="white-space: pre-line;">
            {{ post.content }}
        </div>

        <div class="mt-3">
            <a href="{{ path('blog_index') }}" class="btn btn-outline-secondary btn-sm">← Retour au blog</a>
        </div>
    </article>

    <h2 class="h5 mb-3">Commentaires</h2>

    {% if comments is empty %}
        <p class="text-muted">Aucun commentaire approuvé pour le moment.</p>
    {% else %}
        <div class="vstack gap-3 mb-4">
            {% for c in comments %}
                <div class="p-3 border rounded bg-white">
                    <div class="small text-muted mb-2">
                        {{ c.createdAt|date('Y-m-d H:i') }} — {{ c.author.userIdentifier }}
                    </div>
                    <div style="white-space: pre-line;">{{ c.content }}</div>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    {% if app.user %}
        <div class="bg-white p-3 border rounded">
            <h3 class="h6">Laisser un commentaire</h3>
            {{ form_start(form) }}
            {{ form_row(form.content) }}
            <button class="btn btn-primary btn-sm">Envoyer</button>
            {{ form_end(form) }}
        </div>
    {% else %}
        <div class="alert alert-info">
            Connecte-toi pour commenter :
            <a class="btn btn-sm btn-outline-primary" href="{{ path('app_login') }}">Se connecter</a>
            ou <a class="btn btn-sm btn-outline-secondary" href="{{ path('app_register') }}">Créer un compte</a>
        </div>
    {% endif %}
{% endblock %}
