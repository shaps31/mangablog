{% extends 'base.html.twig' %}

{% block title %}Nouveau Post{% endblock %}

{% block body %}
    <h1>Créer un article</h1>

    {{ include('post/_form.html.twig') }}

    <a class="btn btn-link mt-3" href="{{ path('app_post_index') }}">↩︎ Retour à la liste</a>
{% endblock %}

{% block scripts %}
    <script>
        // auto-slug depuis le titre (sans écraser si l’utilisateur tape lui-même le slug)
        document.addEventListener('DOMContentLoaded', function () {
            const title = document.getElementById('post_title');
            const slug  = document.getElementById('post_slug');
            if (!title || !slug) return;

            let userEditedSlug = false;
            slug.addEventListener('input', function () { userEditedSlug = true; });

            function slugify(str) {
                return str
                    .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
                    .toLowerCase()
                    .replace(/[^a-z0-9]+/g, '-')
                    .replace(/^-+|-+$/g, '');
            }

            title.addEventListener('input', function () {
                if (userEditedSlug && slug.value.trim() !== '') return;
                slug.value = slugify(title.value);
            });
        });
    </script>
{% endblock %}
